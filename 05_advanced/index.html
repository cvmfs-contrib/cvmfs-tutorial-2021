
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.5">
    
    
      
        <title>5. Advanced topics - CernVM-FS tutorial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-topics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="CernVM-FS tutorial" class="md-header-nav__button md-logo" aria-label="CernVM-FS tutorial">
      
  <img src="../img/cvmfs_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            CernVM-FS tutorial
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              5. Advanced topics
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CernVM-FS tutorial
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CernVM-FS tutorial" class="md-nav__button md-logo" aria-label="CernVM-FS tutorial">
      
  <img src="../img/cvmfs_logo.png" alt="logo">

    </a>
    CernVM-FS tutorial
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CernVM-FS tutorial
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../00_azure_cloud_resources/" class="md-nav__link">
        0. Azure cloud resources
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../01_introduction/" class="md-nav__link">
        1. Introduction to CernVM-FS
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../02_stratum0_client/" class="md-nav__link">
        2. Stratum 0 + client
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../03_stratum1_proxies/" class="md-nav__link">
        3. Stratum 1 + proxies
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../04_publishing/" class="md-nav__link">
        4. Publishing
      </a>
    </li>
  

    
      
      
      


  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          5. Advanced topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        5. Advanced topics
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#debugging-issues" class="md-nav__link">
    Debugging issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gateway-and-publishers" class="md-nav__link">
    Gateway and Publishers
  </a>
  
    <nav class="md-nav" aria-label="Gateway and Publishers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gateway" class="md-nav__link">
    Gateway
  </a>
  
    <nav class="md-nav" aria-label="Gateway">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-service" class="md-nav__link">
    Starting the service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publisher" class="md-nav__link">
    Publisher
  </a>
  
    <nav class="md-nav" aria-label="Publisher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements_1" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration_1" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-the-repository" class="md-nav__link">
    Make the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-publishing" class="md-nav__link">
    Start publishing!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#debugging-issues" class="md-nav__link">
    Debugging issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gateway-and-publishers" class="md-nav__link">
    Gateway and Publishers
  </a>
  
    <nav class="md-nav" aria-label="Gateway and Publishers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gateway" class="md-nav__link">
    Gateway
  </a>
  
    <nav class="md-nav" aria-label="Gateway">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-service" class="md-nav__link">
    Starting the service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publisher" class="md-nav__link">
    Publisher
  </a>
  
    <nav class="md-nav" aria-label="Publisher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements_1" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration_1" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-the-repository" class="md-nav__link">
    Make the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-publishing" class="md-nav__link">
    Start publishing!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/edit/master/docs/05_advanced.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="advanced-topics">Advanced topics<a class="headerlink" href="#advanced-topics" title="Permanent link">&para;</a></h1>
<ul>
<li>gateway-publisher (with warnings)<ul>
<li>installing these takes time</li>
<li>prepared: 1 gateway + 2 publishers</li>
<li>demo only (no hands-on)</li>
</ul>
</li>
<li>troubleshooting</li>
<li>exploding containers + use via Singularity<ul>
<li>demo</li>
</ul>
</li>
</ul>
<h2 id="debugging-issues">Debugging issues<a class="headerlink" href="#debugging-issues" title="Permanent link">&para;</a></h2>
<p>If you are experiencing issues with your CernVM-FS setup, there are various ways to start debugging.
Most issues are caused by wrongly configured clients (either a configuration issue, or a wrong public key) and connection or firewall issues.</p>
<p>In order to find the cause of the issue, we should first find out where the issue is being caused. You can start by checking the client configuration for syntax errors:
<div class="highlight"><pre><span></span><code>sudo cvmfs_config chksetup
</code></pre></div>
This should return <code>OK</code>.  To make sure that your configuration is really picked up and set correctly
(because of the hierarchical structure of the configuration, it is easily possible that some parameter gets overwritten by another configuration file),
you can dump the effective configuration for your repository using:
<div class="highlight"><pre><span></span><code>cvmfs_config showconfig repo.organization.tld
</code></pre></div>
Make sure that at least <code>CVMFS_HTTP_PROXY</code> and <code>CVMFS_SERVER_URL</code> are set correctly, and that the directory pointed to by <code>CVMFS_KEYS_DIR</code> really contains the (correct) public key file.</p>
<p>The <code>probe</code> subcommand can be used for (re)trying to mount the repository, and should normally return <code>OK</code>:
<div class="highlight"><pre><span></span><code>cvmfs_config probe repo.organization.tld
Probing /cvmfs/repo.organization.tld... OK
</code></pre></div></p>
<p>But, since you were debugging an issue, it probably returns an error. So, let's enable some debugging output by adding the following line to your <code>/etc/cvmfs/default.local</code>:
<div class="highlight"><pre><span></span><code>CVMFS_DEBUGLOG=/path/to/cvmfs.log
</code></pre></div>
Now we unmount the repository, re-run the setup step, and try to probe it again:</p>
<div class="highlight"><pre><span></span><code>sudo cvmfs_config umount
sudo cvmfs_config setup
cvmfs_config probe repo.organization.tld
</code></pre></div>
<p>You can now check your debug log file, and look for any error messages near the bottom of the file; they may reveal more details about the issue.</p>
<p>If it turns out to be some kind of connection issue, you can trace it down further by manually checking the connections to your proxy and/or Stratum 1 server.
First, let's rule out that it is some kind of firewall issue by verifying that you can actually connect to the appropriate ports on those servers:
<div class="highlight"><pre><span></span><code>telnet url-to-your-proxy 3128
telnet url-to-your-stratum1 80
</code></pre></div></p>
<p>If this does work, probably something is wrong with the services running on these machines.
Every CernVM-FS repository has a file named <code>.cvmfspublished</code>, and you can try to fetch it manually using <code>curl</code>, both directly from the Stratum 1 and via your proxy:
<div class="highlight"><pre><span></span><code># Without your own proxy, i.e. directly go to the Stratum 1:
curl --head http://url-to-your-stratum1/cvmfs/repo.organization.tld/.cvmfspublished

# With your caching proxy between the client and Stratum 1:
curl --proxy http://url-to-your-proxy:3128 --head http://url-to-your-stratum1/cvmfs/repo.organization.tld/.cvmfspublished
</code></pre></div></p>
<p>These commands should return <code>HTTP/1.1 200 OK</code>. If the first command returns something else, you should inspect your CernVM-FS, Apache, and Squid configuration (and log) files on the Stratum 1 server. If the first <code>curl</code> command does work, but the second does not, there is something wrong with your Squid proxy; make sure that it is running, configured, and able to access your Stratum 1 server.</p>
<h2 id="gateway-and-publishers">Gateway and Publishers<a class="headerlink" href="#gateway-and-publishers" title="Permanent link">&para;</a></h2>
<p>Only being able to modify your repository on the Stratum 0 server can be a bit of a limitation,
especially when multiple people have to maintain the repository.</p>
<p>A quite new feature in CernVM-FS allows you to set up so-called publisher machines, which are separate machines
that are allowed to modify the repository. It also allows for setting up simple ACLs to give certain machines only access to subtrees of the repository.</p>
<p>In order to use this feature you also need a gateway machine that has the repository storage mounted; the easiest way to set it up is by having a single machine that serves as both the
Stratum 0 and the gateway. This is the setup that we will explain here.</p>
<p>Do note that this is a fairly new feature and is not used a lot by production sites yet.
Therefore, use it at your own risk!</p>
<h3 id="gateway">Gateway<a class="headerlink" href="#gateway" title="Permanent link">&para;</a></h3>
<h4 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h4>
<p>This machine has the same requirements as a standard Stratum 0 server, except that it also needs
an additional port for the gateway service. This port is configurable, but by default port 4929 is used.</p>
<h4 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h4>
<p>Perform the installation steps for the Stratum 0, which can be found in an earlier section.
Additionally, install the <code>cvmfs-gateway</code> package:
<div class="highlight"><pre><span></span><code>sudo yum install -y cvmfs-gateway
</code></pre></div></p>
<p>Now make your repository using:
<div class="highlight"><pre><span></span><code>sudo cvmfs_server mkfs -o $USER repo.organization.tld
</code></pre></div></p>
<h4 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h4>
<p>The gateway requires you to set up a configuration file <code>/etc/cvmfs/gateway/repo.json</code>.
This is a JSON file containing the name of the repository, the keys that can be used by publishers to get
access to the repository, and the (sub)path that these publishers are allowed to publish to.</p>
<p>The <code>cvmfs-gateway</code> package will make an example file for you, which you can edit or overwrite.
It should look like this:
<div class="highlight"><pre><span></span><code>{
    &quot;version&quot;: 2,
    &quot;repos&quot; : [
        {
            &quot;domain&quot; : &quot;repo.organization.tld&quot;,
            &quot;keys&quot; : [
                {
                    &quot;id&quot;: &quot;keyid1&quot;,
                    &quot;path&quot;: &quot;/&quot;
                },
                {
                    &quot;id&quot;: &quot;keyid2&quot;,
                    &quot;path&quot;: &quot;/restricted/to/subdir&quot;
                }
            ]
        }
    ],
    &quot;keys&quot; : [
        {
            &quot;type&quot; : &quot;plain_text&quot;,
            &quot;id&quot; : &quot;keyid1&quot;,
            &quot;secret&quot; : &quot;SOME_SECRET&quot;
        },
        {
            &quot;type&quot; : &quot;plain_text&quot;,
            &quot;id&quot; : &quot;keyid2&quot;,
            &quot;secret&quot; : &quot;SOME_OTHER_SECRET&quot;
        },
    ]
}
</code></pre></div></p>
<p>You can choose the key IDs and secrets yourself; the secret has to be given to the owner of the
corresponding publisher machine.</p>
<p>Finally, there is a second configuration file <code>/etc/cvmfs/gateway/user.json</code>.
This is where you can, for instance, change the port of the gateway service and the maximum length of
an acquired lease. Assuming you do not have to change the port, you can leave it as it is for now.</p>
<h4 id="starting-the-service">Starting the service<a class="headerlink" href="#starting-the-service" title="Permanent link">&para;</a></h4>
<p>We can now start the gateway service using:
<div class="highlight"><pre><span></span><code>systemctl start cvmfs-gateway
</code></pre></div></p>
<p>Do note that, once this service is running, you should not open transactions on this machine anymore, or you
may corrupt the repository. If you do want to open a transaction, stop the gateway service first.</p>
<h3 id="publisher">Publisher<a class="headerlink" href="#publisher" title="Permanent link">&para;</a></h3>
<h4 id="requirements_1">Requirements<a class="headerlink" href="#requirements_1" title="Permanent link">&para;</a></h4>
<p>This machine has no special requirements.</p>
<h4 id="installation_1">Installation<a class="headerlink" href="#installation_1" title="Permanent link">&para;</a></h4>
<p>The publisher only needs the <code>cvmfs-server</code> package to be installed:
<div class="highlight"><pre><span></span><code>sudo yum install -y https://ecsft.cern.ch/dist/cvmfs/cvmfs-release/cvmfs-release-latest.noarch.rpm
sudo yum install -y cvmfs-server
</code></pre></div></p>
<h4 id="configuration_1">Configuration<a class="headerlink" href="#configuration_1" title="Permanent link">&para;</a></h4>
<p>The publisher machine only needs three files with keys:</p>
<ul>
<li>the repository's public key: <code>repo.organization.tld.pub</code>;</li>
<li>the repository's public key encoded as X509 certificate: <code>repo.organization.tld.crt</code>;</li>
<li>the gateway API key stored in a file named <code>repo.organization.tld.gw</code>.</li>
</ul>
<p>The first two files can be taken from <code>/etc/cvmfs/keys</code> on your Stratum 0 server.
The latter can be created manually and should just contain the secret that you used in the gateway configuration.</p>
<p>Place all these files in some (temporary) directory on your publisher machine.</p>
<h4 id="make-the-repository">Make the repository<a class="headerlink" href="#make-the-repository" title="Permanent link">&para;</a></h4>
<p>We can now make the repository available for writing on our publisher machine by running:
<div class="highlight"><pre><span></span><code>sudo cvmfs_server mkfs -w http://YOUR_STRATUM0_GATEWAY/cvmfs/repo.organization.tld \
                       -u gw,/srv/cvmfs/repo.organization.tld/data/txn,http://YOUR_STRATUM0_GATEWAY:4929/api/v1 \
                       -k /path/to/keys/dir -o `whoami` repo.organization.tld
</code></pre></div>
Replace both occurrences of <code>YOUR_STRATUM0_GATEWAY</code> by the IP address or hostname of your gateway / Stratum 0 server (and change 4929 in case you changed the gateway port), and <code>/path/to/keys/dir</code> by the path where you
stored the keys in the previous step.</p>
<h4 id="start-publishing">Start publishing!<a class="headerlink" href="#start-publishing" title="Permanent link">&para;</a></h4>
<p>You should now be able to make changes to the repository by opening a transaction:
<div class="highlight"><pre><span></span><code>cvmfs_server transaction repo.organization.tld

# MAKE CHANGES TO /cvmfs/repo.organization.tld

cvmfs_server publish repo.organization.tld
</code></pre></div></p>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 19, 2021</span>
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../04_publishing/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                4. Publishing
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>