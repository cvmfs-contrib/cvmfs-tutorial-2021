
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.5">
    
    
      
        <title>2. Stratum 0 and client - CernVM-FS tutorial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-stratum-0-and-client" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="CernVM-FS tutorial" class="md-header-nav__button md-logo" aria-label="CernVM-FS tutorial">
      
  <img src="../img/cvmfs_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            CernVM-FS tutorial
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              2. Stratum 0 and client
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CernVM-FS tutorial
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CernVM-FS tutorial" class="md-nav__button md-logo" aria-label="CernVM-FS tutorial">
      
  <img src="../img/cvmfs_logo.png" alt="logo">

    </a>
    CernVM-FS tutorial
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CernVM-FS tutorial
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../00_azure_cloud_resources/" class="md-nav__link">
        0. Azure cloud resources
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../01_introduction/" class="md-nav__link">
        1. Introduction to CernVM-FS
      </a>
    </li>
  

    
      
      
      


  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          2. Stratum 0 and client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        2. Stratum 0 and client
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#21-setting-up-the-stratum-0" class="md-nav__link">
    2.1 Setting up the Stratum 0
  </a>
  
    <nav class="md-nav" aria-label="2.1 Setting up the Stratum 0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-requirements" class="md-nav__link">
    2.1.1 Requirements
  </a>
  
    <nav class="md-nav" aria-label="2.1.1 Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operating-system" class="md-nav__link">
    Operating system
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-installing-cernvm-fs" class="md-nav__link">
    2.1.2 Installing CernVM-FS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-starting-apache-webserver" class="md-nav__link">
    2.1.3 Starting Apache webserver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-creating-the-repository" class="md-nav__link">
    2.1.4 Creating the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-repository-keys" class="md-nav__link">
    2.1.5 Repository keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216-adding-files-to-the-repository" class="md-nav__link">
    2.1.6 Adding files to the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-cron-job-for-resigning-the-whitelist" class="md-nav__link">
    2.1.7 Cron job for resigning the whitelist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218-removing-a-repository" class="md-nav__link">
    2.1.8 Removing a repository
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-setting-up-a-client" class="md-nav__link">
    2.2 Setting up a client
  </a>
  
    <nav class="md-nav" aria-label="2.2 Setting up a client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-installing-the-client-package" class="md-nav__link">
    2.2.1 Installing the client package
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-configuring-the-client" class="md-nav__link">
    2.2.2 Configuring the client
  </a>
  
    <nav class="md-nav" aria-label="2.2.2 Configuring the client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#public-key-of-repository" class="md-nav__link">
    Public key of repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-repository-configuration" class="md-nav__link">
    Main repository configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-client-configuration" class="md-nav__link">
    Local client configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-mounting-the-repositories" class="md-nav__link">
    2.2.3 Mounting the repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-inspecting-the-repository" class="md-nav__link">
    2.2.4 Inspecting the repository
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../03_stratum1_proxies/" class="md-nav__link">
        3. Stratum 1 and proxies
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../04_publishing/" class="md-nav__link">
        4. Publishing
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../05_advanced/" class="md-nav__link">
        5. Advanced topics
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#21-setting-up-the-stratum-0" class="md-nav__link">
    2.1 Setting up the Stratum 0
  </a>
  
    <nav class="md-nav" aria-label="2.1 Setting up the Stratum 0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-requirements" class="md-nav__link">
    2.1.1 Requirements
  </a>
  
    <nav class="md-nav" aria-label="2.1.1 Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operating-system" class="md-nav__link">
    Operating system
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-installing-cernvm-fs" class="md-nav__link">
    2.1.2 Installing CernVM-FS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-starting-apache-webserver" class="md-nav__link">
    2.1.3 Starting Apache webserver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-creating-the-repository" class="md-nav__link">
    2.1.4 Creating the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-repository-keys" class="md-nav__link">
    2.1.5 Repository keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216-adding-files-to-the-repository" class="md-nav__link">
    2.1.6 Adding files to the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-cron-job-for-resigning-the-whitelist" class="md-nav__link">
    2.1.7 Cron job for resigning the whitelist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218-removing-a-repository" class="md-nav__link">
    2.1.8 Removing a repository
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-setting-up-a-client" class="md-nav__link">
    2.2 Setting up a client
  </a>
  
    <nav class="md-nav" aria-label="2.2 Setting up a client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-installing-the-client-package" class="md-nav__link">
    2.2.1 Installing the client package
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-configuring-the-client" class="md-nav__link">
    2.2.2 Configuring the client
  </a>
  
    <nav class="md-nav" aria-label="2.2.2 Configuring the client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#public-key-of-repository" class="md-nav__link">
    Public key of repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-repository-configuration" class="md-nav__link">
    Main repository configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-client-configuration" class="md-nav__link">
    Local client configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-mounting-the-repositories" class="md-nav__link">
    2.2.3 Mounting the repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-inspecting-the-repository" class="md-nav__link">
    2.2.4 Inspecting the repository
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/edit/master/docs/02_stratum0_client.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="2-stratum-0-and-client">2. Stratum 0 and client<a class="headerlink" href="#2-stratum-0-and-client" title="Permanent link">&para;</a></h1>
<p>In order to get started with CernVM-FS, the first thing you need is a Stratum 0 server.</p>
<p>The Stratum 0 is the <em>central server</em> that hosts your repositories and makes it available to other systems.
<strong>There can be only one Stratum 0 server for each CernVM-FS repository</strong>, and from a security perspective it is recommended to restrict the access to this system.
We will look more into that later.</p>
<p>For now, we are going to set up a Stratum 0, create a repository, and access it by connecting from a client machine directly to the Stratum 0 server.</p>
<p align="center">
<img src="../img/stratum0_client.png" alt="CernVM-FS - Stratum 0 + client" width="350px"/>
</p>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Directly connecting to the Stratum 0 is</strong> <strong><em>not</em></strong> <strong>recommended</strong>, but it is a good way to get started.</p>
<p>In the <a href="../03_stratum1_proxies/">next hands-on part of this tutorial</a> we will remedy this by setting up a Stratum 1
replica server and squid proxy, and accessing the repository that way instead.</p>
</div>
<h2 id="21-setting-up-the-stratum-0">2.1 Setting up the Stratum 0<a class="headerlink" href="#21-setting-up-the-stratum-0" title="Permanent link">&para;</a></h2>
<h3 id="211-requirements">2.1.1 Requirements<a class="headerlink" href="#211-requirements" title="Permanent link">&para;</a></h3>
<h4 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h4>
<p>Due to the scalable design of CernVM-FS, the Stratum 0 server does not need a lot of resources in terms of CPU cores and memory;
just a few cores and a couple gigabytes of memory is sufficient.</p>
<p>Besides this, you do need sufficient storage space to store the contents of your repository.
CernVM-FS uses <code>/var/spool/cvmfs</code> as scratch space while adding new files to the repository, and <code>/srv/cvmfs</code> as central repository storage location.
To change these locations, you can create either of the paths as a symbolic link to a different directory.</p>
<h4 id="operating-system">Operating system<a class="headerlink" href="#operating-system" title="Permanent link">&para;</a></h4>
<p>Several (popular) Linux distributions are supported by CernVM-FS,
see <a href="https://cvmfs.readthedocs.io/en/stable/cpt-quickstart.html#getting-the-software">the Getting Started page of the CernVM-FS documentation</a> for a full list.</p>
<p>In this tutorial we will use CentOS 8 on <code>x86_64</code>, but it should be relatively straightforward to use another OS or CPU architecture instead.</p>
<p>CernVM-FS supports for hosting the repository contents in S3 compatible storage, but for this tutorial we will focus on storing the files locally
on the Stratum 0 server.</p>
<p>For this we need an Apache (web)server on the host, and port 80 must be open.</p>
<h3 id="212-installing-cernvm-fs">2.1.2 Installing CernVM-FS<a class="headerlink" href="#212-installing-cernvm-fs" title="Permanent link">&para;</a></h3>
<p>Installing CernVM-FS is simple and only requires some packages to be installed.</p>
<p>You can easily do this by adding the CernVM-FS repository and install the packages through your package manager:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># sudo yum install -y epel-release  # only needed on CentOS 7</span>
sudo yum install -y https://ecsft.cern.ch/dist/cvmfs/cvmfs-release/cvmfs-release-latest.noarch.rpm
sudo yum install -y cvmfs cvmfs-server
</code></pre></div>
<p>Alternatively, you can download the packages from the <a href="https://cernvm.cern.ch/fs/">CernVM-FS downloads page</a> and install them package manually.</p>
<p>Note that you need both the client and server package installed on the Stratum 0 server.</p>
<h3 id="213-starting-apache-webserver">2.1.3 Starting Apache webserver<a class="headerlink" href="#213-starting-apache-webserver" title="Permanent link">&para;</a></h3>
<p>Since the Stratum 0 is serving contents via HTTP, the Apache service needs to be running before we can make a repository.</p>
<p>The Apache (<code>httpd</code>) package should have been installed already, as it is a dependency of the <code>cvmfs-server</code> package,
so the service can now be enabled (so that it always starts after a reboot) and started using:
<div class="highlight"><pre><span></span><code>sudo systemctl enable httpd
sudo systemctl start httpd
</code></pre></div></p>
<h3 id="214-creating-the-repository">2.1.4 Creating the repository<a class="headerlink" href="#214-creating-the-repository" title="Permanent link">&para;</a></h3>
<p>Now that all required packages have been installed, we can create a CernVM-FS repository.</p>
<p>In the simplest way, this can be done by running the following command, which will make the current user the owner of the repository:
<div class="highlight"><pre><span></span><code>sudo cvmfs_server mkfs -o <span class="nv">$USER</span> repo.organization.tld
</code></pre></div></p>
<p>The full repository name (here <code>repo.organization.tld</code>) resembles a DNS name, but the <code>organization.tld</code> domain does not actually need to exist.</p>
<p>It is recommended to give all the repositories belonging to the same project or organization the same <code>.organization.tld</code> domain.
This makes the client configuration much easier, also in case new repositories will be added later on.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please come up with a proper name for your repository, including a domain you will remember throughout this tutorial.
Do not use <code>repo.organization.tld</code>.</p>
<p>For example, use <code>repo.&lt;your_first_name&gt;.org</code>, where you replace <code>&lt;your_first_name&gt;</code> with (you guessed it) your
first name. Feel free to use something else than your first name, of course.</p>
</div>
<h3 id="215-repository-keys">2.1.5 Repository keys<a class="headerlink" href="#215-repository-keys" title="Permanent link">&para;</a></h3>
<p>For each repository that you create, a set of keys will be generated in <code>/etc/cvmfs/keys</code>:</p>
<ul>
<li><code>*.crt</code>:  the repository’s public key (encoded as an X509 certificate);</li>
<li><code>*.key</code>: the repository's private key;</li>
<li><code>*.masterkey</code>: the repository's private <em>master</em> key;</li>
<li><code>*.pub</code>: repository’s public <em>master</em> key (RSA).</li>
</ul>
<p>The public master key (<code>repo.organization.tld.pub</code>) is the one that is needed by clients in order to access the repository, so we will need this later on.</p>
<p>The private master key (<code>repo.organization.tld.masterkey</code>) is used to sign a whitelist of known publisher certificates,
and should <em>not</em> be shared with others.
This whitelist is (by default) valid for 30 days, so the signing has to be done regularly (for example via a cron job).</p>
<p>Although you can use a different master key per repository, it is recommended to use the same master key
for all repositories under a single domain, so that clients only need a single public master key to access all repositories under this domain.
For more information, see the CernVM-FS documentation:
<a href="https://cvmfs.readthedocs.io/en/stable/cpt-repo.html#master-keys">https://cvmfs.readthedocs.io/en/stable/cpt-repo.html#master-keys</a>.</p>
<h3 id="216-adding-files-to-the-repository">2.1.6 Adding files to the repository<a class="headerlink" href="#216-adding-files-to-the-repository" title="Permanent link">&para;</a></h3>
<p>A new repository automatically gets a file named <code>new_repository</code> in its root (<code>/cvmfs/repo.organization.tld</code>). You can add more files by starting and publishing a transaction, which will be explained in more detail in the <a href="../04_publishing/">3rd hands-on part of this tutorial</a>.</p>
<p>For now it is enough to just run the following commands to add a simple <code>hello.sh</code> script to your repository.</p>
<p>First, start the transaction via <code>cvmfs_server transaction &lt;name_of_repo&gt;</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Change this to your repository/domain name!</span>
<span class="nv">MY_REPO_NAME</span><span class="o">=</span>repo.organization.tld
</code></pre></div>
<div class="highlight"><pre><span></span><code>cvmfs_server transaction <span class="si">${</span><span class="nv">MY_REPO_NAME</span><span class="si">}</span>
</code></pre></div>
<p>Next, add the file to the repository (in <code>/cvmfs/${MY_REPO_NAME}</code>).
If you made the current user the owner of the repository, you can do this without <code>sudo</code> since you have write
permissions to your repository:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="s1">&#39;#!/bin/bash&#39;</span> &gt; /cvmfs/<span class="si">${</span><span class="nv">MY_REPO_NAME</span><span class="si">}</span>/hello.sh
<span class="nb">echo</span> <span class="s1">&#39;echo hello&#39;</span> &gt;&gt; /cvmfs/<span class="si">${</span><span class="nv">MY_REPO_NAME</span><span class="si">}</span>/hello.sh
chmod a+x /cvmfs/<span class="si">${</span><span class="nv">MY_REPO_NAME</span><span class="si">}</span>/hello.sh
</code></pre></div>
<p>Complete the transaction by publishing the changes using:</p>
<div class="highlight"><pre><span></span><code>cvmfs_server publish <span class="si">${</span><span class="nv">MY_REPO_NAME</span><span class="si">}</span>
</code></pre></div>
<h3 id="217-cron-job-for-resigning-the-whitelist">2.1.7 Cron job for resigning the whitelist<a class="headerlink" href="#217-cron-job-for-resigning-the-whitelist" title="Permanent link">&para;</a></h3>
<p>Each CernVM-FS repository has a whitelist containing fingerprints of certificates that are allowed to sign the repository.
This whitelist has an expiration time of (by default) 30 days, so you regularly have to resign the whitelist.</p>
<p>There are several ways to do this, see for instance <a href="https://cvmfs.readthedocs.io/en/stable/cpt-repo.html#sct-master-keys">the page about master keys</a>
in the CernVM-FS documentation.</p>
<p>If you keep the master key on our Stratum 0 sever, you can set up a simple cronjob for resigning the whitelist. For instance, make a file <code>/etc/cron.d/cvmfs_resign</code> with the following content to do this every Monday at 11:00:
<div class="highlight"><pre><span></span><code>0 11 * * 1 root /usr/bin/cvmfs_server resign repo.organization.tld
</code></pre></div></p>
<p>For the sake of this tutorial this is not really necessary of course, but it's an important aspect to be aware of.</p>
<h3 id="218-removing-a-repository">2.1.8 Removing a repository<a class="headerlink" href="#218-removing-a-repository" title="Permanent link">&para;</a></h3>
<p>An existing repository can be removed easily by running:
<div class="highlight"><pre><span></span><code>sudo cvmfs_server rmfs repo.organization.tld
</code></pre></div></p>
<p>Obviously you should only do this when you actually <em>want</em> to get rid of the repository...</p>
<h2 id="22-setting-up-a-client">2.2 Setting up a client<a class="headerlink" href="#22-setting-up-a-client" title="Permanent link">&para;</a></h2>
<p>Accessing a CernVM-FS repository on a client system involves three steps:</p>
<ol>
<li>installing the CernVM-FS client package;</li>
<li>adding some configuration files for the repository you want to connect to;</li>
<li>running the CernVM-FS setup procedure that will mount the repository.</li>
</ol>
<p>The client is going to pull in files from the repository over an HTTP connection.
CernVM-FS maintains a local cache on the client, so you need sufficient space for storing it.</p>
<p>You can define the maximum size of your cache in the client configuration.
The larger your cache is, the less often you have to pull in files again, and the faster your applications will start.
Typical client cache sizes range from 4GB to 50GB.</p>
<p>Note that you can add more cache layers by adding a proxy nearby your client,
which will be covered in the <a href="../03_stratum1_proxies/">2nd hands-on part of this tutorial</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure you use a different system (or virtual machine) for the client!</p>
<p>It doesn't make much sense to install both the Stratum 0 server and the CernVM-FS client configuration
on the same system...</p>
</div>
<h3 id="221-installing-the-client-package">2.2.1 Installing the client package<a class="headerlink" href="#221-installing-the-client-package" title="Permanent link">&para;</a></h3>
<p>The installation is the same as for the Stratum 0, except that you only need the <code>cvmfs</code> package
(we don't need to CernVM-FS server component on the client):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># sudo yum install -y epel-release  # only needed on CentOS 7</span>
sudo yum install -y https://ecsft.cern.ch/dist/cvmfs/cvmfs-release/cvmfs-release-latest.noarch.rpm
sudo yum install -y cvmfs
</code></pre></div>
<h3 id="222-configuring-the-client">2.2.2 Configuring the client<a class="headerlink" href="#222-configuring-the-client" title="Permanent link">&para;</a></h3>
<p>Most organizations hosting CernVM-FS repositories offer a client package that you can install to do most of the configuration.
For the sake of this tutorial, we are going to do this manually for our repository.</p>
<p>All required configuration files will have to be stored under <code>/etc/cvmfs</code>.</p>
<p>We will discuss them one by one, where we use <code>repo.organization.tld</code> as repository name, and hence <code>organization.tld</code> as domain.</p>
<p><em>Don't forget to rename or change these files according to the repository name and domain you are using!</em></p>
<h4 id="public-key-of-repository">Public key of repository<a class="headerlink" href="#public-key-of-repository" title="Permanent link">&para;</a></h4>
<p><code>/etc/cvmfs/keys/organization.tld/repo.organization.tld.pub</code></p>
<p>This file contains the public key of the repository you want to access.</p>
<p>You can copy this file from your Stratum 0 server, where it is stored under <code>/etc/cvmfs/keys/</code>.</p>
<h4 id="main-repository-configuration">Main repository configuration<a class="headerlink" href="#main-repository-configuration" title="Permanent link">&para;</a></h4>
<p><code>/etc/cvmfs/config.d/repo.organization.tld.conf</code></p>
<p>This file contains the main configuration for the repository you want to access, which should minimally contain the
URL(s) of the Stratum 1 servers and the location of the keys.</p>
<p>We do not have a Stratum 1 server yet (we will set that up in <a href="../03_stratum1_proxies/">the next hands-on part of this tutorial</a>),
so we are going to connect directly to our Stratum 0 server instead. <strong>You should not do this in production!</strong></p>
<p>A typical, minimal configuration should look as follows:</p>
<div class="highlight"><pre><span></span><code>CVMFS_SERVER_URL=&quot;http://&lt;STRATUM0_IP&gt;/cvmfs/@fqrn@&quot;
CVMFS_KEYS_DIR=&quot;/etc/cvmfs/keys/organization.tld&quot;
</code></pre></div>
<p><strong><em>Replace the <code>&lt;STRATUM0_IP&gt;</code> part with the IP address of your Stratum 0 server!</em></strong></p>
<p>Note that the <code>CVMFS_SERVER_URL</code> should include the part <code>/cvmfs/@fqrn@</code> exactly like that;
the last part (<code>@fqrn@</code>) will be replaced automatically by the full name of your repository.</p>
<h4 id="local-client-configuration">Local client configuration<a class="headerlink" href="#local-client-configuration" title="Permanent link">&para;</a></h4>
<p><code>/etc/cvmfs/default.local</code></p>
<p>This file can be used for setting or overriding client configuration settings that are specific to your system.</p>
<p>The <code>CVMFS_HTTP_PROXY</code> parameter is <em>required</em>: it should point to your local proxy that serves as a cache
between your client(s) and the Stratum 1 server(s).</p>
<p>Since we do not have a proxy yet, we are setting this to <code>DIRECT</code>, meaning that we connect directly to the Stratum 1
server (actually, Stratum 0 at this point):
<div class="highlight"><pre><span></span><code>CVMFS_HTTP_PROXY=DIRECT
</code></pre></div></p>
<p>You can also use this file to specify a maximum size (in megabytes) for the cache.
For example, to use a local cache of maximum 5GB:
<div class="highlight"><pre><span></span><code>CVMFS_QUOTA_LIMIT=5000
</code></pre></div></p>
<h3 id="223-mounting-the-repositories">2.2.3 Mounting the repositories<a class="headerlink" href="#223-mounting-the-repositories" title="Permanent link">&para;</a></h3>
<p>When your client configuration is complete, you can run the following command as root to mount the repository:</p>
<div class="highlight"><pre><span></span><code>sudo cvmfs_config setup
</code></pre></div>
<p>This should not return any output or error messages.
after).</p>
<p>If you do run into a problem, check out
<a href="../05_advanced/#debugging-issues">the debugging section on the Advanced topics page</a>.</p>
<h3 id="224-inspecting-the-repository">2.2.4 Inspecting the repository<a class="headerlink" href="#224-inspecting-the-repository" title="Permanent link">&para;</a></h3>
<p>Finally, we can try to access our repository on the client system.</p>
<p>Note that CernVM-FS uses <code>autofs</code>, which means that you may not see the repository when you just run "<code>ls /cvmfs</code>".
Your repository will only be actually mounted when you access it, and may be unmounted after not using it for a while.</p>
<p>So, the following should work and show the contents of your repository:
<div class="highlight"><pre><span></span><code>ls /cvmfs/repo.organization.tld
</code></pre></div></p>
<h2 id="exercise">Exercise<a class="headerlink" href="#exercise" title="Permanent link">&para;</a></h2>
<p>Time to get your hands dirty! Try this yourself:</p>
<ul>
<li>Set up your own CernVM-FS repository on Stratum 0 server in a virtual machine.</li>
<li>Create a repository with a suitable name (for example, <code>exercise.&lt;your_first_name&gt;.org</code>).</li>
<li>Add a simple bash script to the repository, which, for instance, prints <code>Hello world!</code>.</li>
<li>Install and configure the CernVM-FS client on another virtual machine.
  Access your repository directly via Stratum 0 for now.</li>
<li>Try to access your repository, and run your bash script on the client.</li>
</ul>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 20, 2021</span>
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../01_introduction/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                1. Introduction to CernVM-FS
              </div>
            </div>
          </a>
        
        
          <a href="../03_stratum1_proxies/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                3. Stratum 1 and proxies
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>